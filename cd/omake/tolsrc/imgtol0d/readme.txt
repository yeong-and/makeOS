IMGTOL의 사용법                                     2003.12. 27 카와이 히데미

1. 이것은 무엇인가?

  IMGTOL는 DOS 범용 펑션을 사용해 디스크 이미지를 만들거나 디스크 이미
지를 기입하거나 하는 툴입니다. 그 외에도 디스크 이미지를 취급하는데 있어서 편리한 것이
없을까 생각되는 기능이나, OS개발에 사용할 수 있을 것 같은 기능을 가지고 있습니다.

  그러나 무엇보다도 최대의 특징은, OS의 배포시에 번들 해도 전혀 문제가 되지 않는
라이센스가 적용되고 있는 것으로, 번들로도 방해가 되지 않는 사이즈이겠지요.
2.33KB바이트입니다 (웃음).

2. 간단한 사용법
    read.    >imgtol r [opt] drive: filename  size  (drv -> file)
    write.   >imgtol w [opt] drive: filename [size] (file -> drv)
    exp-w.f. >imgtol f [opt] drive: filename (file -> drv)
    exp-w.   >imgtol F [opt] drive: filename (file -> drv)
    ovrcopy. >imgtol c inputfile outputfile  [size]
    expand.  >imgtol e inputfile outputfile   size
    release. >imgtol R sourceimage compedimage
    exe2sys. >imgtol s inputfile outputfile base(dec)
      opt(sector-bytes) = -512(default), -1024
      size unit : kilobyte

3. 디스크 이미지를 디스크에 기입하는 방법

  PCAT의 경우(1440 KB-FD의 경우)
    prompt>imgtol w a: fdimage.bin

  TOWNS나 NEC98의 경우(1232 KB-FD의 경우)
    prompt>imgtol w -1024 a: fdimage.bin

  이 경우라면 파일이 다할 때까지 기입합니다. 디스크가 다해도 DOS로부터 에러가
오지 않는 한, 기입 명령을 계속 보냅니다 (웃음). 디스크 용량보다 큰 파일을
취급할 때 등은,

  PCAT의 경우(1440 KB-FD의 경우)
    prompt>imgtol w a: fdimage.bin 1440

  TOWNS나 NEC98의 경우(1232 KB-FD의 경우)
    prompt>imgtol w -1024 a: fdimage.bin 1232

등으로 해 주세요. 상한이 설정되어 그 이상은 액세스 하지 않습니다. 또한 액세스는
고속화를 위해서 36KB(-512때) 혹은 16KB(-1024때) 단위로 행하고 있습니다. 이전의
버전에서는 이 단위에서의 오버 런이 있을 수 있었습니다만, 이 버전은 오버 런하지
않습니다.

  「a:」든지 「fdimage.bin」의 부분은 자신의 사용하고 싶은 상황에 맞추어 고쳐 주십시오.
HDD의 드라이브나 다른 디바이스에도 할 수 있습니다(주 1). 또한 31 MB이상으로 액세스할 수 없고,
그 사이 자기 멋대로 정상 종료해 버립니다. 말미의 사이즈 지정도 32767이상을
지정하지 않게 해 주세요.

  덧붙여 도중 경과는 일절 표시되지 않습니다. 느긋하게 기다립시다. 또 「디스크의 내용이
지워집니다, 괜찮습니까?」같은 말도 나옵니다. 그러한 것을 넣고 싶으면
배치파일을 만들어 거기에서 echo나 pause를 해 주세요.

<주 1>
  HDD나 CF에 기입하려고 하면, Win95등에서는 에러가 됩니다. 그러나 이것은 회피
하는 방법이 있습니다. 예를 들면, 드라이브 E:에 기입하고 싶은 경우,

    prompt>lock e:
    prompt>imgtol w e: cfimage.bin
    prompt>unlock e:

그렇다면 문제 없이 기입할 수 있습니다.


4. 디스크를 읽어 디스크 이미지를 만드는 방법

  PCAT의 경우(1440 KB-FD의 경우)
    prompt>imgtol r a: fdimage.bin 1440

  TOWNS나 NEC98의 경우(1232 KB-FD의 경우)
    prompt>imgtol r -1024 a: fdimage.bin 1232 

  사이즈 지정은 생략 할 수 없습니다. 실제 디스크보다 적은 값도 지정할 수 있습니다. 그 경우
에는 거기까지 밖에 읽지 않습니다.

  「a:」든지 「fdimage.bin」의 부분은 자신의 사용하고 싶은 상황에 맞추어 바꿔 써 주세요.
HDD의 드라이브나 다른 디바이스에도 문제 없게 할 수 있습니다만, 31MB이상에는 액세스할 수
없기 때문에 그것은 양해 바랍니다. 31MB를 넘어 액세스 할 수 있는 것은 pcctol입니다.

  덧붙여 도중 경과는 일절 표시되지 않습니다. 느긋하게 기다립시다.

5. 디스크 이미지의 사이즈의 변경의 방법

  예를 들어 600 KB의 AT호환기용 디스크 이미지가 있어, 「이래서야 아 불편하지 아∼,
나는 1440KB의 이미지를 원한다!」라고 할 때는 다음과 같이 합니다.

    prompt>imgtol e src.bin dest.bin 1440

이렇게 하면, 600KB의 src.bin를 확장해 1440KB로 한 것이 dest.bin로서 출력됩니다.
같은 파일을 지정할 수 없습니다. 반드시 입력 파일명과 출력 파일명은
따로 따로 해 주세요. 잘못해서 같은 파일을 지정하면 파일이 망가집니다. 더욱이
1440KB로 확장한다고 해도 요컨데 다만 「00」으로 채워진 섹터를 요구 사이즈로 될 때까지
첨가하고 있을 뿐입니다. 아무것도 만지고 있지 않습니다.

  덧붙여 지정한 파일보다 작은 사이즈를 지정할 수도 있고, 그 경우에는 파일의
뒤가 잘린 결과가 나옵니다. 만든 디스크 이미지의 후반을 잘라 버리고 싶을 
때에 사용합니다. 예에 의해, 31MB이상의 사이즈는 지정할 수 없기 때문에 잘 부탁합니다.

6. over-write 카피의 방법

  over-write 카피라고 하는 것은, 원칙으로서 카피처의 파일 사이즈를 변경하지 않고
카피한다고 해서, 단지 사이즈가 변함없다고 하는 것만이 아니고, 파일의
디스크상의 위치도 불변입니다. OS의 이미지등을 기입하는데 적합합니다.

    prompt>imgtol c src.bin dest.bin 50

으로 하면, src.bin의 최초의 50 KB가 dest.bin에 기입해집니다. 만약 src.bin가 50KB에 만족하지
않으면 그 만큼은 「00」으로 채운 내용을 읽어들인 것으로 하여 write합니다. write사이즈가
dest.bin의 사이즈를 웃돌았을 경우에는, 솔직히 dest.bin의 파일 사이즈를 확장해서
write를 계속합니다. dest.bin의 사이즈 쪽이 write 사이즈보다도 컸을 경우,
사이즈는 변경되지 않습니다. 또 수정할 범위 이외의 내용은 그대로 보관 유지됩니다.
커낸드 실행에 즈음하여 dest.bin이 존재하지 않으면 에러가 됩니다. 마지막 50이라고 하는
사이즈 지정은 생략 할 수 있고, 이 경우에는 src.bin의 사이즈를 지정한 것으로 됩니다.

7. exe2sys로서의 사용 방법

  exe2sys는, exe 파일의 헤더를 해석해 소정의 주소에 리로케이트 한 후의 메모리
이미지를 생성하는 것입니다. OS를 exe 형식에서 만들어 두고, 로드 이미지로 변환
할 경우에 사용합니다.
  
    prompt>imgtol s src.exe dest.bin 2048

이 경우의 마지막 2048은 리로케이트 세그먼트 어드레스입니다. 또한 주의가 필요한 것은,
이 2048이 10진수인 것입니다. 16진수 지정은 할 수 없습니다. 이 경우, 0x0800:0x0000
에 로드 되었다고 해서 리로케이션을 실시하고, 그 결과를 출력합니다.

8. SF16 전용 커맨드군

  imgtol는, Win95의 DOS prompt내에서 SF16 포맷을 걸거나 혹은 SF16 포맷으로
기술된 OS를 인스톨 할 수가 있습니다. SF16 포맷이라고 하는 것은
FAT16을 확장한 것으로, 디스크 이미지를 만들 때에 인스톨처의 용량을
이미 결정해 두지 않아 좋다고 하는 이점을 갖게한 것입니다.

  우선, SF16로 미디어를 포맷 해 봅시다. f커맨드를 사용해, blank 이미지를
기입하게 합니다(sf16_08. bin는 sf16set.lzh안에 있습니다).

    prompt>imgtol f a: sf16_08.bin

  Windows95OSR2. 0으로 실험했는데, 그대로는 잘 인식하지 못하고 오동작을 합니다. 
이렇게 기입한 후에, 일단 디스크를 뽑아 주세요. 그리고 다시 한번 넣으면, 제대로
인식합니다. CF의 경우도 한 번의 정규 조작으로 이젝트 해 주세요. HDD의 경우는
unlock하자 마자 재기동 해 주세요. ···아, 음, FD 이외를 지정할 경우,
w커맨드와 같이 lock/unlock을 할 필요가 있습니다(3. 참조).

  또 f커맨드는 오조작으로 중요한 HDD를 날려 버리거나 하지 않도록, 2.0GB이상의
파티션에의 기입이라고 판단하면, 자주적으로 에러로 하여 일절 기입을 하지 않습니다.

  또 f커맨드는 FAT12나 FAT16, SF16로 미리 포맷되어 있지 않으면 그
드라이브를 잘 인식할 수 없기 때문에, fdisk 후에 일단 적당하게 포맷 하고, 그것부터
이 커맨드로 SF16 포맷 해 주세요.

  그런데, 이것으로 디스크에 여러 가지 기입해서, 그것을 재인스톨 가능한 디스크
이미지로 변환하고 싶어지면 r커맨드와 R커맨드를 사용합니다.

  우선, r커맨드로 디스크 이미지를 꺼냅니다(31MB까지 밖에 꺼낼 수 없기 때문에
그것보다 뒤에는 파일이 존재하지 않게 해 주세요). 이것은 드라이브의 용량
전체일 필요는 없고, 파일이 들어가 있는 곳까지입니다. 그리고,

    prompt>imgtol R rawimage.bin release.bin

등으로 하면, 뒤의 불필요한 부분을 잘라 버릴 수 있어서, f커맨드로 인스톨 가능한 
디스크 이미지로 변환됩니다. 한 번 이 변환을 하면 f커맨드로 좋아하는 용량에 인스톨
할 수 있습니다. w커맨드와 같이 읽어낸 드라이브와 같은 용량이 아니면 안된다는 것은
아닙니다.

9. 사례

  I.Tak. 씨가 나에게 의지를 갖게 해주는 계기를 주었습니다. 정말로 고맙습니다. 

10. 라이센스

  KL-01입니다.
